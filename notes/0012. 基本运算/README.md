# [0012. 基本运算](https://github.com/tnotesjs/TNotes.c/tree/main/notes/0012.%20%E5%9F%BA%E6%9C%AC%E8%BF%90%E7%AE%97)

<!-- region:toc -->

- [1. 🎯 本节内容](#1--本节内容)
- [2. 🫧 评价](#2--评价)
- [3. 🤔 C 语言支持哪些基本运算类型？](#3--c-语言支持哪些基本运算类型)
- [4. 🤔 算术运算符有哪些？它们的行为有何特点？](#4--算术运算符有哪些它们的行为有何特点)
- [5. 🤔 关系运算符和逻辑运算符如何工作？](#5--关系运算符和逻辑运算符如何工作)
- [6. 🤔 什么是短路求值？它在逻辑运算中如何体现？](#6--什么是短路求值它在逻辑运算中如何体现)
- [7. 🆚 按位运算 vs 逻辑运算有什么本质区别？](#7--按位运算-vs-逻辑运算有什么本质区别)
- [8. 🤔 赋值运算符有哪些形式？复合赋值如何简化代码？](#8--赋值运算符有哪些形式复合赋值如何简化代码)
- [9. 🤔 自增（++）和自减（--）运算符的前置与后置有何不同？](#9--自增和自减--运算符的前置与后置有何不同)
- [10. 🤔 逗号运算符的作用是什么？何时使用？](#10--逗号运算符的作用是什么何时使用)
- [11. 🤔 运算符优先级和结合性如何影响表达式求值？](#11--运算符优先级和结合性如何影响表达式求值)

<!-- endregion:toc -->

## 1. 🎯 本节内容

- todo

## 2. 🫧 评价

- todo

## 3. 🤔 C 语言支持哪些基本运算类型？

从表达式的角度看，C 语言支持多种类别的运算，大致可以归纳为几类：

- 算术运算：用于数值加减乘除和取模。
- 关系运算：用于比较两个值的大小和是否相等。
- 逻辑运算：用于布尔逻辑组合和条件判断。
- 按位运算：用于直接操作整数的二进制位。
- 赋值和复合赋值：把表达式结果写入某个变量。
- 自增和自减：对变量执行加一或减一操作。
- 条件运算和逗号运算：对表达式求值顺序和结果进行控制。

理解这些基本运算类型，以及它们对表达式求值的影响，是写出正确 C 代码的基础。

## 4. 🤔 算术运算符有哪些？它们的行为有何特点？

算术运算符主要作用于整数和浮点数，常见的有：

- 加法 `+`
- 减法 `-`
- 乘法 `*`
- 除法 `/`
- 取模 `%` 只适用于整数

需要特别注意的行为包括：

- 整数除法会向零截断，小数部分会被直接丢弃。
- 在 C99 及之后，`%` 的结果与被除数同号。
- 整数溢出，尤其是有符号整数溢出，属于未定义行为。

::: code-group

```c [⚠️ 整数除法和取模]
int a = 5;
int b = 2;
int q = a / b; // 结果是 2，而不是 2.5。
int r = a % b; // 结果是 1。
```

:::

在需要小数结果时，应当使用浮点类型，并注意浮点运算的精度误差。

## 5. 🤔 关系运算符和逻辑运算符如何工作？

关系运算符用于比较两个操作数的大小关系，逻辑运算符则用于把多个布尔条件组合在一起。

- 关系运算符
  - `>`、`<`、`>=`、`<=`、`==`、`!=`。
  - 比较结果为整数 0 或 1，在条件语句中会被当作假或真。
- 逻辑运算符
  - 逻辑与 `&&`
  - 逻辑或 `||`
  - 逻辑非 `!`

在 C 语言中，任何非零值在逻辑环境中都被视为真，零被视为假。逻辑运算的结果总是 0 或 1。

::: code-group

```c [逻辑运算示例]
int a = 3;
int b = 0;

int x = (a > 0) && (b != 0); // x 为 0
int y = (a > 0) || (b != 0); // y 为 1
int z = !a;                  // z 为 0，因为 a 为非零。
```

:::

理解关系运算和逻辑运算的返回值，对写条件判断和循环条件非常重要。

## 6. 🤔 什么是短路求值？它在逻辑运算中如何体现？

短路求值指的是：在计算逻辑表达式时，一旦结果已经可以确定，剩余的子表达式就不再求值。

对于 `&&` 来说：

- 如果左侧为假，整个表达式必为假，右侧不会被求值。

对于 `||` 来说：

- 如果左侧为真，整个表达式必为真，右侧不会被求值。

::: code-group

```c [短路求值示例]
typedef struct {
  int size;
} Buffer;

int is_valid(const Buffer* ptr) {
  // 如果 ptr 为空，右侧不会被求值，因此不会访问 ptr->size。
  return ptr != NULL && ptr->size > 0;
}
```

:::

短路求值既可以用来避免无意义甚至危险的计算，也可能因为存在副作用而导致不易察觉的行为差异。因此，在逻辑表达式中写函数调用或带副作用的表达式时，需要格外小心。

## 7. 🆚 按位运算 vs 逻辑运算有什么本质区别？

按位运算和逻辑运算都使用类似的符号，但语义完全不同。

| 特性     | 按位运算                         | 逻辑运算                     |
| -------- | -------------------------------- | ---------------------------- |
| 作用对象 | 整数的每一位二进制比特           | 整个值在布尔意义上的真和假   |
| 常见运算 | 按位与、按位或、按位异或、取反   | 逻辑与、逻辑或、逻辑非       |
| 运算结果 | 仍然是整数，每一位独立计算       | 结果为 0 或 1                |
| 短路行为 | 无短路，参与运算的表达式都会求值 | 有短路，可能只求值左侧表达式 |

::: code-group

```c [按位与与逻辑与]
unsigned int x = 0xA;
unsigned int y = 0xC;

unsigned int a = x & y;        // 按位与，结果是 0x8。
int b = (x != 0) && (y != 0);  // 逻辑与，结果是 1。
```

:::

在判断条件时，应当使用逻辑运算符。在需要操作标志位或掩码时，才使用按位运算符。

## 8. 🤔 赋值运算符有哪些形式？复合赋值如何简化代码？

最基本的赋值运算符是 `=`，用来把右侧表达式的值写入左侧变量。C 还提供了一系列复合赋值运算符，用于在原值基础上进行运算再赋值。

- 基本赋值
  - `a = b`：把 `b` 的值赋给 `a`。
- 复合赋值
  - `a += b`：等价于 `a = a + b`。
  - `a -= b`：等价于 `a = a - b`。
  - `a *= b` `a /= b` `a %= b`
  - `a &= b` `a |= b` `a ^= b` 等

使用复合赋值的好处在于：

- 能更直观地表达“在原值基础上修改”的意图
- 在某些情况下可以避免重复求值右侧复杂表达式

赋值表达式本身也有值，其结果是左侧变量赋值之后的值。这使得像 `a = b = 0` 这样的链式赋值成为可能，但可读性需要谨慎权衡。

## 9. 🤔 自增（++）和自减（--）运算符的前置与后置有何不同？

自增和自减运算符有前置和后置两种形式。它们都对变量进行加一或减一操作，但表达式的值不同。

- 前置形式
  - `++i`：先对 `i` 加一，然后整个表达式的值是新的 `i`。
  - `--i`：先对 `i` 减一，然后整个表达式的值是新的 `i`。
- 后置形式
  - `i++`：先取得当前 `i` 的值作为表达式的结果，然后再对 `i` 加一。
  - `i--`：类似，先返回原值，再减一。

::: code-group

```c [前置与后置差异]
int i = 1;
int a = ++i; // i 变成 2，a 为 2。

int j = 1;
int b = j++; // b 为 1，然后 j 变成 2。
```

:::

在复杂表达式中频繁使用自增自减运算符，尤其是对同一变量多次自增或自减，容易触发未定义行为。实际开发中更推荐只在简单场景下使用，例如循环控制变量。

## 10. 🤔 逗号运算符的作用是什么？何时使用？

逗号在 C 中既是分隔符，也是一种真正的运算符。逗号运算符会从左到右依次求值多个表达式，并以最后一个子表达式的值作为整个表达式的结果。

::: code-group

```c [逗号运算符示例]
int x = 0;
int y = (x += 1, x * 2); // 先执行 x 加一，再计算 x 乘以二，y 得到 2。
```

:::

逗号运算符在实际代码中使用较少，典型用法主要出现在 `for` 循环的第三个表达式中，用来同时更新多个变量。

需要注意区分：

- 作为运算符的逗号：参与表达式求值，并有返回结果。
- 作为分隔符的逗号：用于函数参数列表、变量声明列表等，不参与运算。

## 11. 🤔 运算符优先级和结合性如何影响表达式求值？

当一个表达式中包含多种运算符时，编译器需要按照运算符的优先级和结合性来决定求值顺序。

- 优先级
  - 指定不同类别运算符之间谁先谁后，例如乘除高于加减。
- 结合性
  - 指定相同优先级运算符的结合方向，例如加减乘除通常是自左向右，赋值和条件运算符通常是自右向左。

某些组合如果依赖默认优先级，很容易引发误解，例如：

::: code-group

```c [⚠️ 易混淆的表达式]
int x = 1;
int y = 2;
int z = 3;

int a = x + y << z;      // 实际上是先计算（x + y），再左移 z 位。
int b = x < y && y < z;  // 两个比较表达式分别求值，再做逻辑与。
```

:::

虽然运算符优先级表是每个 C 程序员都应该了解的基础知识，但在实际工程中，更推荐通过添加括号来主动标明期望的计算顺序，既减少出错概率，也提高代码可读性。
