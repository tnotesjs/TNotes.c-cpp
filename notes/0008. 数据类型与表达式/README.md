# [0008. 数据类型与表达式](https://github.com/tnotesjs/TNotes.c-cpp/tree/main/notes/0008.%20%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F)

<!-- region:toc -->

- [1. 🎯 本节内容](#1--本节内容)
- [2. 🫧 评价](#2--评价)
- [3. 🤔 什么是数据类型？](#3--什么是数据类型)
- [4. 🤔 C 语言中有哪些基本数据类型？](#4--c-语言中有哪些基本数据类型)
- [5. 🤔 什么是变量和常量？](#5--什么是变量和常量)
- [6. 🤔 表达式由什么组成？](#6--表达式由什么组成)
- [7. 🤔 运算符的优先级和结合性如何影响表达式求值？](#7--运算符的优先级和结合性如何影响表达式求值)
- [8. 🆚 整型提升 vs 算术转换有什么区别？](#8--整型提升-vs-算术转换有什么区别)
- [9. 🤔 什么是左值（lvalue）和右值（rvalue）？](#9--什么是左值lvalue和右值rvalue)
- [10. 🤔 混合类型表达式中会发生什么？](#10--混合类型表达式中会发生什么)
- [11. 🆚 C 语言与 C++ 在数据类型处理上有何不同？](#11--c-语言与-c-在数据类型处理上有何不同)

<!-- endregion:toc -->

## 1. 🎯 本节内容

- todo

## 2. 🫧 评价

- todo

<N :ids="['0009', '0010', '0011', '0012', '0013', '0014']" />

## 3. 🤔 什么是数据类型？

在程序中，数据类型用来描述一段内存中存放的是什么样的值，以及可以对它做哪些合法操作。

从编译器视角看，数据类型至少包含三层含义：

- 取值范围：能表示的最小值、最大值，以及是否有小数部分。
- 存储方式：在内存中占用的字节数、对齐方式、表示格式。
- 运算规则：哪些运算符可以作用在这种类型上，结果类型是什么。

有了数据类型，编译器才能在翻译阶段完成类型检查，在运行时正确解释内存中的比特序列。

## 4. 🤔 C 语言中有哪些基本数据类型？

标准 C 语言提供了一组基础的数据类型，后续更复杂的结构都是在它们之上构建的：

- 整型：
  - `char`：通常用来存放字符，也可以看成小整数。
  - `short`、`int`、`long`、`long long`：以及它们对应的无符号形式。
- 浮点型：
  - `float`：单精度。
  - `double`：双精度。
  - `long double`：更高精度，具体取值范围依赖实现。
- 枚举类型：
  - 使用 `enum` 定义的一组命名整数常量。
- 空类型：
  - `void`，表示没有值，常用于函数返回类型或指针类型 `void*`。

此外，C 还支持指针、数组、结构体、共用体等复合类型，但这些会在后续章节单独展开。

## 5. 🤔 什么是变量和常量？

在 C 语言中，变量和常量都是带有类型的值，主要区别在于值是否允许在程序运行过程中发生改变。

- 变量：
  - 有名字、有存储位置、有类型。
  - 在生命周期内可以多次赋值。
  - 例如 `int count`、`double price`。
- 常量：
  - 值在定义后不允许修改。
  - 可以通过字面量、宏定义或 `const` 关键字等方式引入。
  - 例如 `10`、`3.14`、`const int max_size` 等。

合理区分变量和常量，能让代码的意图更清晰，也有利于编译器进行优化。

## 6. 🤔 表达式由什么组成？

表达式是由操作数和运算符按照语法规则组合而成的结构，求值后会产生一个结果。

- 操作数：
  - 可以是字面量、标识符、函数调用的返回值，甚至是另一个子表达式。
- 运算符：
  - 算术运算符：加、减、乘、除、取模。
  - 关系运算符：大于、小于、相等等。
  - 逻辑运算符：与、或、非。
  - 赋值运算符、复合赋值运算符。
  - 条件运算符、函数调用运算符、逗号运算符等。

大多数语句，如条件判断、循环、赋值等，其核心都是在使用某种形式的表达式。

## 7. 🤔 运算符的优先级和结合性如何影响表达式求值？

当一个表达式中出现多个不同的运算符时，编译器需要按照固定的顺序来决定先计算哪一部分，这个顺序由优先级和结合性共同决定。

- 优先级：决定不同运算符之间谁先谁后，例如乘法通常高于加法。
- 结合性：决定同一优先级的运算符是从左往右结合还是从右往左结合，例如减法是左结合，赋值是右结合。

例如，在表达式 `a + b * c` 中，会先计算 `b * c`，再与 `a` 相加；在表达式 `a - b - c` 中，则按照 `(a - b) - c` 的顺序求值。

虽然可以记忆一张优先级表，但在实际开发时，更推荐通过适当添加括号来强化表达式的可读性和安全性。

## 8. 🆚 整型提升 vs 算术转换有什么区别？

在表达式求值过程中，C 会自动进行一些隐式类型转换，其中经常被提到的有整型提升和算术转换。

- 整型提升：
  - 针对单个整型操作数。
  - 将比 `int` 更小的整型类型，如 `char`、`short`，在运算前提升为 `int` 或 `unsigned int`。
  - 目的是在大多数处理器上获得更高的运算效率，并减少溢出风险。
- 算术转换：
  - 针对两个不同算术类型共同参与运算的情形。
  - 为了得到同一类型的结果，按既定规则把两个操作数向“更宽、更精确”的类型转换。
  - 例如，`int` 与 `double` 相加时，一般会先把 `int` 转换为 `double`。

可以理解为：整型提升是针对单个小整型的预处理，而算术转换则是在多种算术类型混合运算时，为统一结果类型而进行的转换。

## 9. 🤔 什么是左值（lvalue）和右值（rvalue）？

在 C 语言中，左值和右值是表达式求值结果的两种基本类别。

- 左值：
  - 表示一个在内存中有持久存储位置的对象。
  - 通常可以出现在赋值号左边，例如 `x = 10` 中的 `x`。
- 右值：
  - 表示一个纯粹的值，可能是字面量，也可能是某个表达式计算出来的临时结果。
  - 一般只能出现在赋值号右边，例如 `x + 1` 的结果。

需要注意的是，有些表达式虽然有地址，但不能作为普通左值使用，比如数组名、函数名等，这些细节会在后续章节进一步展开。

## 10. 🤔 混合类型表达式中会发生什么？

当一个表达式中混合使用不同的算术类型时，编译器会按照既定规则进行隐式转换，以得到一个统一的结果类型：

- 先进行整型提升，让较小的整型提升到 `int` 或 `unsigned int`。
- 再应用通常算术转换，将参与运算的两个操作数转换为某个共同类型。

这会带来一些需要特别注意的现象：

- 整数和浮点数混合运算时，整数会转换为浮点数，可能引入精度问题。
- 有符号类型和无符号类型混合运算时，结果可能超出直觉，甚至变成一个很大的无符号数。
- 整数相除时，即使参与运算的有浮点数，也要留意具体子表达式的类型变化。

理解这些转换规则，有助于解释某些看似异常的计算结果，并指导我们在必要时使用显式类型转换。

## 11. 🆚 C 语言与 C++ 在数据类型处理上有何不同？

C 和 `C++` 在基本数据类型上有较多共通之处，但在类型系统和表达能力上存在一些重要差异：

- 类型种类：
  - `C++` 新增了 `bool`、引用、类类型等更多抽象手段。
  - C 只有整型、浮点型、指针等较基础的类型。
- 类型检查：
  - `C++` 的类型检查通常更严格，支持函数重载、模板等机制。
  - C 在类型转换上更宽松，更容易出现隐式转换带来的问题。
- 面向对象与泛型：
  - `C++` 通过类和模板在类型层面提供了更强的抽象能力。
  - C 主要依靠结构体、指针和约定来组织复杂数据。

在学习本节时，可以先牢固掌握 C 的类型和表达式规则，再在此基础上理解 `C++` 对类型系统所做的扩展。
