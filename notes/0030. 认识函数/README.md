# [0030. 认识函数](https://github.com/tnotesjs/TNotes.c-cpp/tree/main/notes/0030.%20%E8%AE%A4%E8%AF%86%E5%87%BD%E6%95%B0)

<!-- region:toc -->

- [1. 🎯 本节内容](#1--本节内容)
- [2. 🫧 评价](#2--评价)
- [3. 🤔 为什么程序需要函数？](#3--为什么程序需要函数)
- [4. 🤔 函数的基本结构包含哪些部分？](#4--函数的基本结构包含哪些部分)
- [5. 🤔 什么是函数名、参数列表和返回值？](#5--什么是函数名参数列表和返回值)
  - [5.1. 函数名](#51-函数名)
  - [5.2. 参数列表](#52-参数列表)
  - [5.3. 返回值](#53-返回值)
- [6. 🤔 库函数和用户自定义函数有何区别？](#6--库函数和用户自定义函数有何区别)
- [7. 🆚 有返回值函数 vs 无返回值函数（void）如何选择？](#7--有返回值函数-vs-无返回值函数void如何选择)
- [8. 🤔 函数调用时发生了什么？（栈帧、控制流转移）](#8--函数调用时发生了什么栈帧控制流转移)
- [9. 🤔 一个 C 程序中必须有 main 函数吗？为什么？](#9--一个-c-程序中必须有-main-函数吗为什么)
- [10. 🤔 如何阅读和理解一个函数的功能？](#10--如何阅读和理解一个函数的功能)
- [11. 🔗 引用](#11--引用)

<!-- endregion:toc -->

## 1. 🎯 本节内容

- 函数的动机与价值
- 函数的基本结构
- 函数名、参数列表与返回值
- 库函数与自定义函数
- `void` 与返回值函数的选择
- 函数调用与栈帧的直观理解
- `main` 作为程序入口
- 函数阅读与拆解方法

## 2. 🫧 评价

- 入门函数的关键不是背语法，而是建立接口意识，先想清楚输入输出与副作用。
- 如果能把函数写成小而清晰的单元，后续学指针、结构体、模块化都会顺很多。

## 3. 🤔 为什么程序需要函数？

程序需要函数，主要是为了解决三个问题。

1. 复用
2. 抽象
3. 组织

把一段逻辑封装成函数后。

- 你可以在不同位置重复调用
- 你可以用函数名表达意图，让代码更容易读
- 你可以把复杂问题拆成多个小问题，降低耦合

::: code-group

```c [把重复逻辑封装成函数]
#include <stdio.h>

static void print_line(int n, char ch) {
  for (int i = 0; i < n; i++) {
  putchar(ch);
  }
  putchar('\n');
}

int main(void) {
  print_line(10, '-');
  printf("hello\n");
  print_line(10, '-');
  return 0;
}
```

:::

你会发现，主流程的可读性明显提升。

## 4. 🤔 函数的基本结构包含哪些部分？

一个典型的 C 函数由这些部分组成。

- 返回类型
- 函数名
- 形参列表
- 函数体
- `return` 语句

::: code-group

```c [函数结构示意]
int add(int a, int b) {
  int r = a + b;
  return r;
}
```

:::

注意，函数既可以先声明后定义，也可以直接定义。

更推荐写函数声明，尤其是需要跨文件调用时。

## 5. 🤔 什么是函数名、参数列表和返回值？

这三者基本对应了一个函数的对外接口。

### 5.1. 函数名

函数名应该表达行为或目的。

- `sum`、`max`、`parse_int` 这类名称更清晰
- 避免用含糊的 `do_work`、`handle` 作为唯一信息

### 5.2. 参数列表

参数列表描述调用者需要提供的输入。

通常要关注两类信息。

- 值语义还是指针语义
- 输入参数还是输出参数

::: code-group

```c [输入参数与输出参数]
#include <stdlib.h>

static int parse_u32(const char *s, unsigned int *out) {
  if (s == NULL || out == NULL) {
  return 0;
  }
  (void)s;
  *out = 0;
  return 1;
}
```

:::

### 5.3. 返回值

返回值用于返回计算结果或状态。

- 纯计算函数适合返回结果
- 需要报告错误的函数常返回状态码，数据通过输出参数返回

## 6. 🤔 库函数和用户自定义函数有何区别？

库函数是标准库或第三方库提供的函数，例如 `printf`、`malloc`。

用户自定义函数是你自己写的函数，用于封装业务逻辑。

两者的主要差异。

- 库函数通常有稳定的文档与行为约定
- 自定义函数的接口语义需要你自己设计与维护

::: code-group

```c [库函数与自定义函数一起使用]
#include <stdio.h>

static int max2(int a, int b) {
  return a > b ? a : b;
}

int main(void) {
  printf("%d\n", max2(3, 5));
  return 0;
}
```

:::

⚠️ 使用库函数时要先确认头文件与参数类型，避免隐式声明或类型错配。

## 7. 🆚 有返回值函数 vs 无返回值函数（void）如何选择？

| 特性     | 有返回值函数           | `void` 函数                              |
| -------- | ---------------------- | ---------------------------------------- |
| 主要目的 | 产出结果或状态         | 执行动作或产生副作用                     |
| 典型场景 | `sum`、`find`、`parse` | `print`、`init`、`cleanup`               |
| 错误处理 | 可返回状态码或错误码   | 常通过全局状态或输出参数表达，容易不清晰 |

经验上。

1. 纯计算优先用返回值
2. 需要报告错误时优先返回状态码
3. `void` 更适合输出、日志、释放资源这类只做事不产出值的函数

::: code-group

```c [返回状态码更清晰]
static int div_int(int a, int b, int *out) {
  if (out == NULL || b == 0) {
  return 0;
  }
  *out = a / b;
  return 1;
}
```

:::

## 8. 🤔 函数调用时发生了什么？（栈帧、控制流转移）

从直观角度看，函数调用可以理解为两件事。

1. 控制流跳转到被调用函数
2. 为被调用函数准备运行环境

在大多数平台上，这个运行环境可以粗略理解为栈帧。

- 保存返回地址
- 保存部分寄存器或临时值
- 放置局部变量

函数返回时，控制流会回到调用点的下一行。

::: code-group

```c [调用与返回的控制流]
#include <stdio.h>

static int f(int x) {
  return x + 1;
}

int main(void) {
  int y = f(10);
  printf("%d\n", y);
  return 0;
}
```

:::

⚠️ 递归本质就是函数调用的重复嵌套，因此深度过大容易栈溢出。

## 9. 🤔 一个 C 程序中必须有 main 函数吗？为什么？

对于一个可执行程序来说，通常需要有 `main` 作为入口。

操作系统或运行时会从入口开始执行，然后在 `main` 返回时结束进程。

常见的 `main` 形态。

::: code-group

```c [main 的常见写法]
int main(void);
int main(int argc, char **argv);
```

:::

⚠️ 库项目不一定需要 `main`，因为它本身不作为可执行入口。

## 10. 🤔 如何阅读和理解一个函数的功能？

阅读一个函数时，优先按接口到实现的顺序。

1. 先看函数名与注释，判断意图
2. 再看参数列表，分清输入与输出
3. 再看返回值，判断它返回的是结果还是状态
4. 最后看实现，重点关注边界与错误路径

一眼看不懂的函数，通常是接口语义不清或承担了太多职责。

你可以用拆分策略。

- 把长函数按阶段拆成多个小函数
- 把重复代码抽成独立函数
- 把相关数据打包成结构体，减少参数数量

## 11. 🔗 引用

- [cppreference：Functions][1]
- [cppreference：Function declaration][2]
- [cppreference：main function][3]

[1]: https://en.cppreference.com/w/c/language/function
[2]: https://en.cppreference.com/w/c/language/function_declaration
[3]: https://en.cppreference.com/w/c/language/main_function
